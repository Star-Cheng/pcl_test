# PCL[https://xgyopen.github.io/2018/12/24/2018-12-24-imv-pcl-book/]

## 1. PCD文件头格式

+ VERSION: 指定PCD文件的版本号
+ FIELDS: 指定PCD文件中存储的点云数据的字段, 每个字段用空格分隔
+ SIZE: 每个字段占用的字节数, 每个字节数用空格分隔
+ TYPE: 每个字段的数据类型, 每个数据类型用空格分隔
+ COUNT: 每个字段存储的点云数据个数, 每个个数用空格分隔
+ WIDTH: 用点的数量表示点云数据的宽度, 用点的数量表示点云数据集的宽度。根据是有序点云还是无序点云, WIDTH有两层解释：
一是它能确定无序数据集的点云中点的个数（和下面的POINTS一样）；
二是它能确定有序点云数据集的宽度（一行中点的数目）。
+ HEIGHT: 用点的数目表示点云的高度, 1. 表示有序点云的高度, 即行的总数; 2. 对于无需点云, 它被置为1, 用来检查点云是有序还是无序
+ VIEWPOINT: 指定数据集中点云的获取视点。VIEWPOINT有可能在不同坐标系之间转换的时候应用, 在辅助获取其他特征时也比较有用, 例如曲面法线, 在判断方向一致性时, 需要知道视点的方位,  视点信息被指定为平移（txtytz）+四元数（qwqxqyqz）。默认值是： VIEWPOINT 0 0 0 1 0 0 0
+ POINTS: 点云数据的总点数
+ DATA: 点云数据的存储格式, ASCII或BINARY

## 2. k-d tree

+ k-d tree是数据结构, 用于快速查找数据集中的点。k-d tree的构造过程是, 将数据集分成k个子集, 每个子集的点都按照某一个维度进行排序, 然后按照排序后的顺序, 将子集分成左右两个子集, 重复这个过程, 直到每个子集的点数小于等于k。k-d tree的查询过程是, 从根节点开始, 按照某一个维度进行比较, 比较完之后, 将比较结果分为左右两个子节点, 然后继续比较, 直到找到目标点

## 3. 点云处理方法

### 3.1 点云滤波

+ 点云滤波是点云处理中的一个重要步骤，其目的是去除点云数据中的噪声和杂点，提高点云数据的质量
+ 根据空间距离滤波
    1. 体素滤波: 将点云空间划分为体素, 每个体素内只保留一个点, 从而去除点云中的密集噪声
    2. 半径滤波: 对于每个点, 计算其邻域内点的数量, 如果邻域内点的数量小于某个阈值, 则该点被认为是噪声点
+ 根据统计特征滤波
    1. 统计滤波: 计算每个点的平均值和标准差, 如果点的值与平均值的偏差超过某个阈值, 则该点被认为是噪声点
    2. 条件滤波: 根据点云数据的某个属性来判断点是否为噪声点, 例如, 可以根据点的高度来去除地面上的噪声点
+ 根据曲率滤波
    1. 高斯滤波: 使用高斯滤波器对点云数据进行平滑处理, 从而去除点云中的尖刺噪声
    2. 双边滤波: 双边滤波器考虑了点之间的空间距离和颜色差异，能够更好地保留点云数据的边缘信息

### 3.2 点云关键点

+ 在点云处理中，关键点是指点云中具有重要特征的点，通常可以用于描述点云的局部形状和结构
+ 关键点特点
    1. 稀疏性：关键点的数量远少于原始点云的数量，从而提高了点云处理的效率
    2. 代表性：关键点能够代表点云中的主要特征，例如边缘、拐角、曲率变化等
    3. 稳定性：关键点的位置在不同的视角下应该保持稳定
+ 关键点提取
    1. 基于特征的方法: 根据点云中的曲率、表面法向量等特征来提取关键点
        1. Harris角点检测：利用角点在两个方向上响应很大的灰度协方差矩阵来定义角点
        2. SIFT特征提取：利用尺度不变特征变换来提取关键点
        3. FAST特征提取：利用加速鲁棒特征提取来提取关键点
    2. 基于密度的方法: 通过计算点云中每个点周围的密度来提取关键点
        1. DBSCAN算法：通过聚类来提取关键点
        2. Mean Shift算法：通过模式搜索来提取关键点

### 3.3 点云分割

+ 点云分割是指根据点云数据的空间、几何、纹理等特征将点云划分成不同区域或对象的的过程。点云分割是点云处理中的一个重要步骤，其目的是将点云数据组织成更易于理解和分析的形式
+ 基于欧几里得距离的分割方法
    1. 这种方法依据点之间的空间距离来进行分割。例如，区域生长算法就是一种典型的基于欧几里得距离的分割方法，它从一个种子点开始，将空间上相邻且具有相似属性的点合并成更大的区域。
+ 基于图的分割方法
    1. 这些方法构建点云的图表示，如k-近邻图或最小生成树，然后应用图割（Graph Cut）算法来进行分割。这些方法能够有效地处理具有复杂结构的点云数据。
+ 基于聚类的分割方法
    1. 例如K-means或DBSCAN等聚类算法可以应用于点云分割。这些方法根据点的特征（如位置、颜色、法线方向）将点云分成几个集群，每个集群代表一个独立的对象或区域。
+ 基于模型的分割方法
    1. 这些方法假设点云数据可以由一组已知的几何模型（如平面、球体、圆柱体）来表示，并试图找到最佳的模型来拟合数据
+ 深度学习方法
    1. 随着深度学习的发展，基于神经网络的点云分割方法已经成为研究热点。例如，PointNet、PointNet++和PointCNN等网络能够直接从原始点云数据中学习特征并进行有效的分割。
+ 基于体素的分割方法
    1. 这些方法首先将点云转换为体素网格（一种三维像素表示），然后应用传统的图像分割技术，如阈值分割或区域生长

### 3.4 点云配准

+ 点云匹配是指在两个或多个点云之间找到对应点或对应关系的过程。点云匹配是点云处理中的一个重要步骤，其目的是将不同视角、不同时间或不同传感器获取的点云进行融合，从而获得更完整、更精确的三维信息
+ 基于特征的匹配
    1. ICP: 迭代最近点算法，通过迭代计算两组点云中对应点的最近点来进行匹配
    2. NDT: 法线距离变换，通过计算两组点云中对应点的法线距离来进行匹配
    3. FPFH: 快速点特征直方图，通过计算点云中每个点的特征直方图来进行匹配
+ 基于全局一致性的匹配
    1. RANSAC：随机采样一致性，通过随机采样两组点云中的对应点，并计算它们的模型一致性来进行匹配
    2. GICP：高斯ICP，通过考虑点云的噪声来进行匹配

### 3.5 点云分类/语义分割

+ 点云分类/语义分割是指将点云中的每个点分配一个语义标签，例如地面、建筑物、树木、人等。点云分类/语义分割是点云处理中的一个重要步骤，其目的是将点云数据组织成更易于理解和分析的形式
    1. 点云分类：将每个点分配一个类别标签，例如地面、建筑物、树木、人等
    2. 点云语义分割：将每个点分配一个语义标签，例如道路、人行道、草地、建筑物立面等
+ 基于特征的方法
    1. 形状特征：例如，利用点云的曲率、表面法向量等形状特征来进行分类/语义分割。
    2. 纹理特征：例如，利用点云的颜色、纹理等纹理特征来进行分类/语义分割。
    3. 深度特征：例如，利用点云的深度信息来进行分类/语义分割
+ 基于模型的方法
    1. 支持向量机 (SVM)：SVM 是一种机器学习算法，可以用于点云分类/语义分割
    2. 随机森林 (RF)：RF 是一种机器学习算法，可以用于点云分类/语义分割
    3. 深度学习：深度学习是一种机器学习算法，可以用于点云分类/语义分割

### 3.6 模型重建

+ 模型重建是指从图像、点云等数据中恢复三维模型的过程。从点云中获取更精简更紧凑的模型，如mesh模型。
+ 基于图像的模型重建
    1. 立体匹配：通过匹配两张或多张图像中的对应点来恢复三维模型
    2. 结构光：通过投射结构光图案来恢复三维模型
    3. 深度学习：通过深度学习来恢复三维模型
+ 基于点云的模型重建
    1. 三角网格化：将点云转换为三角网格来恢复三维模型
    2. 体素化：将点云转换为体素来恢复三维模型
    3. 深度学习：通过深度学习来恢复三维模型

## 4. PCL头文件

### 4.1 PCL头文件的作用

+ <pcl/io/pcd_io.h>: 用于点云的输入/输出操作，特别是PCD（点云数据）文件格式的读写。
+ <pcl/point_types.h>: 定义了PCL库中使用的各种点类型。
+ <liblas/liblas.hpp>: 与LAS文件格式相关的头文件，通常用于读写激光雷达数据。
+ <pcl/kdtree/kdtree_flann.h>: 提供基于FLANN的K-D树搜索结构，用于快速点云邻域搜索。
+ <pcl/octree/octree.h>: 提供八叉树结构，用于高效的点云搜索和管理。
+ <pcl/features/normal_3d.h>: 用于估计点云中点的表面法线。
+ <pcl/visualization/cloud_viewer.h>: 提供简单的点云可视化工具。
+ <pcl/keypoints/sift_keypoints.h>: 提供SIFT关键点检测功能。
+ <pcl/keypoints/harris_3D.h>: 提供3D Harris角点检测功能。
+ <pcl/keypoints/uniform_sampling.h>: 提供均匀采样关键点检测功能。
+ <pcl/filters/extract_indices.h>: 用于根据提供的索引提取点云中的点。
+ <pcl/registration/icp.h>: 提供迭代最近点（ICP）算法，用于点云之间的配准。
+ <pcl/registration/ndt.h>: 提供正态分布变换（NDT）算法，也用于点云配准。
+ <pcl/sample_consensus/ransac.h>: 提供随机抽样一致（RANSAC）算法，常用于模型拟合。
+ <pcl/sample_consensus/sac_model_plane.h>: 提供基于RANSAC的平面模型拟合。
+ <pcl/common/transforms.h>: 提供点云变换的功能，如旋转和平移。
+ <pcl/common/distances.h>: 提供计算点云中点之间距离的函数。

### 4.2 PCL点云数据点类型

+ point_types.hpp中有完整点云类型定义。
+ PointXYZ：空间点坐标
+ PointXYZI：空间点坐标+强度
+ PointXYZRGB：空间点坐标+RGB颜色
+ PointXYZRGBA：空间点坐标+RGB颜色+透明度

## 5 PCL点云滤波

### 5.1 点云滤波方法

+ 点云滤波的目的主要有以下几个方面
    1. 降噪：在获取点云数据时，由于设备的限制或环境干扰等因素，点云中往往会含有噪声。滤波可以去除或减少这些噪声，提高数据的质量
    2. 下采样: 点云数据可能非常庞大，包含数百万甚至数十亿个点。对点云进行下采样，即减少点的数量，可以减小数据处理的计算量，提高处理效率，同时保持足够的细节
    3. 统一密度: 在某些情况下，点云中的点密度可能不均匀。滤波可以帮助调整点的分布，使点云在整个区域中保持相对均匀的密度
    4. 移除离群点: 点云中可能包含一些远离主要数据集的离群点。这些点可能是由于错误的测量或其他外界因素引起的。滤波可以识别并移除这些离群点

### 5.1 常用点云滤波

+ 滤波
    1. 直通滤波：通过设置一个最小值和最大值来过滤掉超出范围的点
    2. 体素滤波：通过设置一个体素大小来对点云进行全局降采样
    3. 均值滤波：通过计算每个点周围的平均值来平滑点云
    4. 统计滤波：随机选择一定数量的点来构建点云
    5. 条件滤波：通过设置条件来过滤点云，例如根据点的颜色、强度、距离等属性进行过滤
    6. 半径滤波：通过设置一个半径来过滤掉与给定点距离大于该半径的点
    7. 模型滤波：通过拟合模型来过滤点云，例如通过拟合平面来过滤掉平面上的点
    8. 高斯滤波：通过设置一个高斯核来平滑点云
    9. 双边滤波：通过设置一个颜色权重和空间权重来平滑点云
    10. 投影滤波：通过投影点云到平面来过滤掉平面上的点

## 6 点云关键点

### 6.1 关键点概念

+ 关键点也称为兴趣点，它是2D图像、3D点云或曲面模型上，可以通过定义检测标准来获取的具有稳定性、区别性的点集

### 6.2 常用关键点提取算法

#### 6.2.1 ISS关键点检测

+ ISS关键点检测算法原理
    1. 这种方法通过考虑点的邻域特征来提取关键点。它计算每个点的特征并选取特征值较高的点作为关键点
    2. 基于点云数据的几何特征，主要用于三维点云数据的关键点检测。
    3. 通过分析每个点的邻域的几何特性，如曲率和法线变化，选择稳定且显著的点作为关键点。
    4. 常用于3D形状匹配和对象识别。
+ ISS关键点检测算法特点
    1. 具有良好的稳定性和重复性。
    2. 对噪声有一定的鲁棒性。

#### 6.2.2 SIFT关键点检测

+ SIFT关键点检测算法原理
    1. SIFT通过构建尺度空间，利用高斯差分（DoG）检测尺度不变特征点，并计算特征点的方向直方图生成特征向量。

+ SIFT关键点检测算法特点
    1. 具有尺度和旋转不变性。
    2. 对光照变化和噪声有较强的鲁棒性。

+ SIFT关键点检测算法优点
    1. 特征点稳定，匹配精度高。
    2. 在图像匹配、物体识别等应用中表现出色。

#### 6.2.3 Harris 3D角点检测

+ Harris 3D角点检测算法原理
    1. Harris 3D角点检测通过计算点云中每个点的协方差矩阵，检测出具有局部最大响应的点作为角点。

+ Harris 3D角点检测算法特点
    1. 类似于2D图像处理中的Harris角点检测，这个方法在3D点云中检测角点作为关键点。
    2. Harris角点检测的三维扩展版。
    3. 通过计算点云中每个点的协方差矩阵，识别出局部最大值点作为角点。
    4. 适用于3D点云数据的特征提取和匹配。

#### 6.2.4 SUSAN角点检测

+ SUSAN角点检测算法原理
    1. Harris 3D角点检测通过计算点云中每个点的协方差矩阵，检测出具有局部最大响应的点作为角点。

+ SUSAN角点检测算法特点
    1. 这是另一种基于角点检测的方法，用于提取3D点云中的特征点
    2. 基于区域均匀性的一种角点检测方法。
    3. 通过计算每个像素的邻域内与中心像素灰度值相同的像素数，检测出显著变化点作为角点。
    4. 具有较好的噪声鲁棒性和计算效率。

#### 6.2.5 NARF关键点检测

+ NARF关键点检测算法原理
    1. NARF算法通过分析点云的法线方向和邻域结构，提取具有方向性和几何稳定性的关键点

+ NARF关键点检测算法特点
    1. 能够提取具有方向性和几何特征的关键点。
    2. 适用于3D对象识别和点云配准。

#### 6.2.6 3D-SALIENT点检测

+ 3D-SALIENT点检测算法原理
    1. 3D-SALIENT点检测基于显著性分析，通过计算点云中每个点的显著性度量值（如曲率、法线变化等），选出显著特征点。

+ 3D-SALIENT点检测算法特点
    1. 能够提取局部显著性高的点。
    2. 适用于3D形状分析和目标检测。

## 7 点云特征描述

+ 点云的特征描述是点云处理和分析中的一个重要环节，主要效果是从原始的点云数据中提取有用的信息。在PCL（点云库）中，有几种常用的点云特征描述方法，例如PFH、FPFH、VFH等，主要用于对象识别、分类、配准和分析等任务。

### 7.1 法线估计

+ 法线是最基本的点云特征之一，涉及计算点云中每个点的表面法线。法线是了解表面形状和方向的关键。

+ PCL中的所有点云的法线都是指向视点的，视点坐标默认为(0,0,0)，对视点进行设置，则可对法线进行定向

+ 在PCL中，创建法线估计向量ne然后ne.compute(*normals);

### 7.2 主曲率

+ 主曲率是基于局部表面的形状来描述点的特征。它通常与法线估计一起使用
+ pcl::PrincipalCurvaturesEstimation是PCL中的点云曲率估计方法，其在法线计算的基础上对点云的曲率进行计算
